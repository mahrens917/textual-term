# Gitleaks configuration for ci_shared
# See: https://github.com/gitleaks/gitleaks#configuration

title = "gitleaks config for ci_shared"

[extend]
# Use default gitleaks rules
useDefault = true

[allowlist]
description = "Allowlisted files and patterns"

# Allowlist runtime/cache paths so gitleaks can skip massive directories that
# routinely store model artifacts or temporary exports in Zeus/AWS worktrees.
paths = [
    '''\.git/''',
    '''node_modules/''',
    '''vendor/''',
    '''htmlcov/''',
    '''\.coverage''',
    '''\.ci_check_marker''',
    '''\.pytest_cache/''',
    '''\.ruff_cache/''',
    '''\.mypy_cache/''',
    '''__pycache__/''',
    '''\.pyc$''',
    '''.xci/''',
    '''logs/''',
    '''artifacts/''',
    '''models/''',
    '''payloads/''',
    '''metadata/''',
    '''trash/''',
    '''\.DS_Store$''',
    '''tests/data/parquet/''',
    '''src/weather_data_collector\.egg-info/''',
    # Test file with ANSI escape codes in event key assertions
    '''tests/unit/kalshi_market_updater/test_event_extractor\.py''',
]

# Allowlist specific patterns
regexes = [
    # Test fixtures with fake data
    '''(fake|dummy|mock|test)[-_](key|secret|token|password)''',
    # Example configurations
    '''example[_-]config''',
    '''config[._-]example''',
    # Common false positives
    '''EXAMPLE_API_KEY''',
    '''YOUR_API_KEY_HERE''',
    '''INSERT_YOUR_''',
    # Python class declarations (CamelCase class names trigger false positives)
    '''class\s+[A-Z][A-Za-z0-9]+''',
    # Test class names that follow Test* pattern
    '''Test[A-Za-z0-9]+''',
    # Long Kalshi metadata entries (e.g., SOURCES.txt) are safe.
    '''src/pdf/visualization/(continuousgpsurfaceevaluator|threedimensionalsurfaceplotter)''',
]

# Allowlist specific commits (if needed)
# commits = ["commit-sha-here"]

# Entropy detection - tuned to avoid false positives on long class names
[[rules]]
id = "high-entropy-strings"
description = "Detect high entropy strings (potential secrets)"
# entropy range: 0.0 to 8.0, higher = more random
# Require both high entropy (5.0+) AND length (50+ chars) to reduce false positives
regex = '''[A-Za-z0-9+/]{50,}'''
entropyMin = 5.0
entropyMax = 8.0

# Additional custom rules can be added here
# Example:
# [[rules]]
# id = "custom-internal-api-key"
# description = "Internal API key pattern"
# regex = '''internal[-_]api[-_]key\s*[:=]\s*['"]?([A-Za-z0-9]{32,})'''
